<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Historial</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="estilos/estiloslogin.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-[#fef3c7] background-pattern font-[Poppins] text-[#78350f] min-h-screen p-4">
  <div class="fixed top-4 right-24 z-50">
    <a href="#" id="btnAyuda" class="bg-white/90 backdrop-blur-sm p-2 rounded-full shadow-md border border-white/70 flex items-center justify-center">
      <img src="imagenes/ayuda.png" alt="Ayuda" class="h-10 w-10 object-contain"/>
    </a>
  </div>
  <div class="max-w-5xl mx-auto relative">
    <h1 class="text-5xl font-bold text-center mb-4 tracking-wide">Historial</h1>
    <p class="text-center text-lg md:text-xl font-medium mb-8 px-4">
      Este es tu registro de actividades en Culturita: los audios que has descargado, los alumnos que has registrado y los estados que has explorado junto a tu grupo.
    </p>

    <div id="seccionesHistorial" class="space-y-8">
      <section class="bg-[#ffffff] backdrop-blur-sm p-6 md:p-8 rounded-xl shadow-lg border border-[#78350f]">
        <h2 class="text-2xl font-semibold mb-4">üéß Audios descargados (CuentaCuentos)</h2>
        <div id="historialAudios" class="space-y-4 text-[15px]"></div>
      </section>

      <section class="bg-[#ffffff] backdrop-blur-sm p-6 md:p-8 rounded-xl shadow-lg border border-[#78350f]">
        <h2 class="text-2xl font-semibold mb-4">üßë‚Äçüéì Alumnos registrados (Mi Mapa M√°gico)</h2>
        <div id="historialAlumnos" class="space-y-4 text-[15px]"></div>
      </section>

      <section class="bg-[#ffffff] backdrop-blur-sm p-6 md:p-8 rounded-xl shadow-lg border border-[#78350f]">
        <h2 class="text-2xl font-semibold mb-4">üåé Estados explorados (Exploradores de Tradici√≥n)</h2>
        <div id="historialEstados" class="space-y-4 text-[15px]"></div>
      </section>
    </div>

    <div class="text-center mt-10">
      <button id="btnLimpiarHistorial" class="bg-[#78350f] hover:bg-[#fbbf24] text-[#fde68a] hover:text-[#78350f] font-bold py-2 px-6 rounded-full shadow-md transition-all duration-200">
        üßπ Limpiar todo el historial
      </button>
    </div>

    <p class="text-center text-sm text-[#4b3b2a] mt-12 italic">
      üåô Este registro es solo el comienzo del viaje del Maestro Narrador...
    </p>
  </div>
  <script src="scripts/supabase.js"></script>
  <script src="scripts/modelos.js"></script>
  <script src="scripts/historial.js"></script>
  <script src="scripts/accesibilidad.js"></script>
  
  <script>
  // Configuraci√≥n espec√≠fica para historial.html
  sistemaAyuda.guiaPasos = [
      {
          selector: 'h1.text-5xl',
          titulo: 'T√≠tulo Principal',
          descripcion: 'Esta es tu p√°gina de Historial donde puedes ver todas tus actividades en Culturita.',
          posicionFlecha: 'bottom',
          posicionPersonalizada: { top: '30%', left: '50%' }
      },
      {
          selector: 'p.text-center.text-lg',
          titulo: 'Descripci√≥n del Historial',
          descripcion: 'Aqu√≠ se explica el prop√≥sito de esta p√°gina: registrar tus actividades, alumnos y exploraciones.',
          posicionFlecha: 'bottom',
          posicionPersonalizada: { top: '40%', left: '50%' }
      },
      {
          selector: '#seccionesHistorial section:nth-child(1)',
          titulo: 'Audios Descargados',
          descripcion: 'En esta secci√≥n ver√°s todos los audios que has descargado desde CuentaCuentos.',
          posicionFlecha: 'top',
          posicionPersonalizada: { top: '40%', left: '50%' }
      },
      {
          selector: '#seccionesHistorial section:nth-child(2)',
          titulo: 'Alumnos Registrados',
          descripcion: 'Aqu√≠ encontrar√°s la lista de alumnos que has registrado en Mi Mapa M√°gico.',
          posicionFlecha: 'top',
          posicionPersonalizada: { top: '55%', left: '50%' }
      },
      {
          selector: '#seccionesHistorial section:nth-child(3)',
          titulo: 'Estados Explorados',
          descripcion: 'Esta secci√≥n muestra los estados que has explorado en Exploradores de Tradici√≥n.',
          posicionFlecha: 'top',
          posicionPersonalizada: { top: '70%', left: '50%' }
      },
      {
          selector: '#btnLimpiarHistorial',
          titulo: 'Limpiar Historial',
          descripcion: 'Con este bot√≥n puedes eliminar todo tu historial de forma permanente.',
          posicionFlecha: 'top',
          posicionPersonalizada: { top: '65%', left: '50%' }
      }
  ];

  // Sobreescribir el m√©todo de explicaci√≥n completa para historial.html
  sistemaAyuda.mostrarModalExplicacion = function() {
      const modalHTML = `
          <div id="modalExplicacion" class="fixed inset-0 bg-black/60 flex items-center justify-center z-[100]">
              <div class="bg-white rounded-2xl p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                  <div class="flex justify-between items-center mb-4">
                      <h3 class="text-2xl font-bold text-[#78350f]">üìö Gu√≠a Completa - P√°gina de Historial</h3>
                      <button onclick="document.getElementById('modalExplicacion').remove()" 
                              class="text-2xl text-gray-500 hover:text-red-500">√ó</button>
                  </div>

                  <div class="space-y-6">
                      <div class="bg-amber-50 p-4 rounded-lg border-l-4 border-amber-500">
                          <h4 class="font-bold text-lg mb-2">üéØ Prop√≥sito de esta p√°gina</h4>
                          <p>La p√°gina de Historial es tu centro de control donde puedes ver y gestionar todas las actividades que has realizado en Culturita. Es como tu diario de trabajo educativo.</p>
                      </div>

                      <div class="grid md:grid-cols-3 gap-4">
                          <div class="bg-white p-4 rounded-lg border border-amber-200">
                              <h4 class="font-bold text-lg mb-2 flex items-center gap-2">
                                  <span>üéß Audios Descargados</h4>
                              <p class="mb-3">Desde CuentaCuentos:</p>
                              <ul class="list-disc ml-5 space-y-1 text-sm text-left">
                                  <li>Audios que has descargado</li>
                                  <li>Informaci√≥n del contenido</li>
                                  <li>Fecha de descarga</li>
                                  <li>Puedes eliminarlos individualmente</li>
                              </ul>
                          </div>

                          <div class="bg-white p-4 rounded-lg border border-amber-200">
                              <h4 class="font-bold text-lg mb-2 flex items-center gap-2">
                                  <span>üßë‚Äçüéì Alumnos Registrados</h4>
                              <p class="mb-3">Desde Mi Mapa M√°gico:</p>
                              <ul class="list-disc ml-5 space-y-1 text-sm text-left">
                                  <li>Lista de tus alumnos</li>
                                  <li>Origen y costumbres</li>
                                  <li>Indicador de edici√≥n reciente</li>
                                  <li>Gesti√≥n individual</li>
                              </ul>
                          </div>

                          <div class="bg-white p-4 rounded-lg border border-amber-200">
                              <h4 class="font-bold text-lg mb-2 flex items-center gap-2">
                                  <span>üåé Estados Explorados</h4>
                              <p class="mb-3">Desde Exploradores de Tradici√≥n:</p>
                              <ul class="list-disc ml-5 space-y-1 text-sm text-left">
                                  <li>Estados que has visitado</li>
                                  <li>Informaci√≥n cultural</li>
                                  <li>Tradiciones y palabras</li>
                                  <li>Fechas de exploraci√≥n</li>
                              </ul>
                          </div>
                      </div>

                      <div class="bg-blue-50 p-4 rounded-lg">
                          <h4 class="font-bold text-lg mb-2">üí° ¬øC√≥mo usar esta p√°gina?</h4>
                          <ol class="list-decimal ml-5 space-y-2 text-left">
                              <li><strong>Revisa cada secci√≥n</strong> para ver tus actividades</li>
                              <li><strong>Elimina elementos individuales</strong> con el bot√≥n üóëÔ∏è</li>
                              <li><strong>Usa "Limpiar todo el historial"</strong> para borrar todo</li>
                              <li><strong>Los audios eliminados</strong> solo se borran del historial, no de CuentaCuentos</li>
                              <li><strong>Los alumnos y estados eliminados</strong> se borran permanentemente</li>
                          </ol>
                      </div>

                      <div class="bg-green-50 p-4 rounded-lg">
                          <h4 class="font-bold text-lg mb-2">‚ö†Ô∏è Importante sobre eliminaci√≥n</h4>
                          <div class="space-y-2 text-sm">
                              <p><strong>Audios:</strong> Solo se eliminan de tu historial, permanecen disponibles en CuentaCuentos para volver a descargar.</p>
                              <p><strong>Alumnos y Estados:</strong> Se eliminan permanentemente y no podr√°s recuperarlos.</p>
                              <p class="text-amber-700 font-semibold">¬°La acci√≥n de limpiar todo el historial no se puede deshacer!</p>
                          </div>
                      </div>
                  </div>

                  <div class="mt-6 text-center">
                      <button onclick="document.getElementById('modalExplicacion').remove()" 
                              class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-6 rounded-lg transition">
                          Entendido, ¬°gracias!
                      </button>
                  </div>
              </div>
          </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHTML);
  };

  // Configurar el bot√≥n de ayuda
  document.addEventListener('DOMContentLoaded', function() {
      const btnAyuda = document.getElementById('btnAyuda');
      if (btnAyuda) {
          btnAyuda.addEventListener('click', function(e) {
              e.preventDefault();
              sistemaAyuda.mostrarOpcionesAyuda();
          });
      }

      // DEBUG: Verificar que los selectores funcionen
      console.log('=== DEBUG SELECTORES HISTORIAL ===');
      sistemaAyuda.guiaPasos.forEach((paso, index) => {
          const elemento = document.querySelector(paso.selector);
          console.log(`Paso ${index + 1} (${paso.selector}):`, elemento ? 'ENCONTRADO' : 'NO ENCONTRADO', elemento);
      });
  });
  </script>
</body>
</html>
